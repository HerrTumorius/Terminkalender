<html>
<head>
    <link rel="stylesheet" href="style.css" />
    <script>

    var win = window.open("python.py", "nichts", target = "_blank");

    function openForm() {
    document.getElementById("myForm").style.display = "block";
    }
    function speichern(datum) {
    console.log("speichern");
    websocket.send(JSON.stringify({ action: 'termin', inhalt: [name.textContent,datum,gruppe.textContent]}));

    }
    function closeForm() {
    document.getElementById("myForm").style.display = "none";
    }

    function nanzeige(){
    document.getElementById("aname").style.display = "block";
    }
    function nclose(){
    document.getElementById("aname").style.display = "none";
    }
    function ganzeige(){
    document.getElementById("gruppe").style.display = "block";
    }
    function gclose(){
    document.getElementById("gruppe").style.display = "none";
    }

    var websocket = new WebSocket("ws://127.0.0.1:6789/"),
    name = document.querySelector(".name"),
    gruppe = document.querySelector(".gruppe");

    websocket.onmessage = function (event) {
    data = JSON.parse(event.data);
    console.log("htmldata:", data);
    switch (data.type) {
    case 'anmelden':
      if (data.value != "Benutzername oder Passwort existiert nicht") {
        alert("Anmeldung erfolgreich");
        document.getElementById('name').value = data.value;
    } else {
    alert(data.value);
    }
    break;
    case 'termin':
    if (data.value != "Es gibt keinen perfekten Termin"){
    ptermine = data.value[0];
    }
    if (data.value != "Es gibt keinen fast perfekten Termin"){
    fptermine = data.value[1];
    }
    break;
    default:
    console.error(
    "unsupported event",
    data);
    }
    }
    function klick(event) {
        console.log("zurueck");
        document.getElementById('name').value = "nicht angemeldet";
        //name.textContent = "nicht angemeldet";
    }
    function klickt(event) {
    console.log("anmeldesend");
    websocket.send(JSON.stringify({ action: 'anmelden', inhalt: [document.forms["anmelden"]["fname"].value, document.forms["anmelden"]["fpsw"].value] }));
    }
    </script>
    <script type="text/javascript" src="calendar.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
         <body>
                  <div class="topnav">
                    <a class="active" href="index.html">Home</a>
                     <button class="agruppe" onclick="ganzeige()">Gruppen</button>
                          <div class="gpopup" id="gruppe">
                            <form  class="gcontainer" method="post">
                            <button type="text" class="gruppe">Gruppenname</button>
                            <button type="button" onclick="document.location ='neue_gruppe.html'" class="ngruppe">Neue Gruppe</button>
                            <button type="button" onclick="gclose()" class="gclose">Close</button>
                            </form>
                          </div>

                   <input type="button" class="name" id="name" value="nicht angemeldet" onclick="nanzeige()"></input>
                    <div class="popup" id="aname">
                     <form  class="container" method="post">
                     <button type= "submit" onsubmit="klick()" class="abmelden">Abmelden</button>

                     <button type="button" onclick="nclose()" class="close">Close</button>
                    </form>
                   </div>
                 </div>

                  <table border="1" id="calendar" align="center">
                  <tr style="visibility:collapse;" hidden>
                        <td colspan="7" id="date_memory">---</td>
                  </tr>
                  <tr>
                        <td class="calendar_head"><a class="calendar_link"
                                href="javascript:prevMonth()"> &laquo;</a></td>
                        <td colspan="5" class="calendar_head_month" id="calendar_month">
                                ---</td>
                        <td class="calendar_head"><a class="calendar_link"
                                href="javascript:nextMonth()"> &raquo;</a></td>
                  </tr>
                  <tr>
                        <td class="calendar_day">Mo</td>
                        <td class="calendar_day">Di</td>
                        <td class="calendar_day">Mi</td>
                        <td class="calendar_day">Do</td>
                        <td class="calendar_day">Fr</td>
                        <td class="calendar_day">Sa</td>
                        <td class="calendar_day">So</td>
                 </tr>
                 <tr>
                        <td class="calendar_entry" id="calendar_entry_1">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_2">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_3">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_4">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_5">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_6">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_7">-x-</td>
                </tr>
                <tr>
                        <td class="calendar_entry" id="calendar_entry_8">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_9">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_10">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_11">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_12">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_13">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_14">-x-</td>
                </tr>
                <tr>
                        <td class="calendar_entry" id="calendar_entry_15">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_16">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_17">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_18">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_19">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_20">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_21">-x-</td>
                </tr>
                <tr>
                        <td class="calendar_entry" id="calendar_entry_22">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_23">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_24">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_25">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_26">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_27">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_28">-x-</td>
                </tr>
                <tr>
                        <td class="calendar_entry" id="calendar_entry_29">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_30">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_31">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_32">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_33">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_34">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_35">-x-</td>
                </tr>
                <tr>
                        <td class="calendar_entry" id="calendar_entry_36">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_37">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_38">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_39">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_40">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_41">-x-</td>
                        <td class="calendar_entry" id="calendar_entry_42">-x-</td>
                </tr>
        </table>

        <script type="text/javascript">
            iniCalendar();

            /*0 = wie bisher, Datum wird in die Box geschrieben*/
            setReturnModus(1);
            /*1 = neu, Eventtext wird in die Box geschrieben
            Das event muss in der calendar.js in der Function
            getEventtext definiert werden.*/
            //setReturnModus(1);
        </script>


        

                 <button class="open-button" onclick="openForm()">Anmelden</button>

                 <div class="form-popup" id="myForm">
                   <form class="form-container" name="anmelden" method="post" onsubmit="klickt()" required>
                     <h1>Login</h1>

                     <label for="name"><b>Benutzername</b></label>
                     <input type="text" placeholder="Enter Name" name="fname" required>

                     <label for="psw"><b>Password</b></label>
                     <input type="password" placeholder="Enter Password" name="fpsw" required>

                     <button type="submit" method="post" class="btn">Anmelden</button>
                     <button type="button" class="btn neu" onclick="document.location ='neuer_benutzer.html'">Neuer Benutzer</button>
                     <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
                   </form>
                 </div>


         </body>
</html>